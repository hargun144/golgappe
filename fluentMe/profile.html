<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Stats</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="stats-container">
    
    <!-- Header -->
    <div class="header-card">
      <h1>üéâ Great Job!</h1>
      <p>You‚Äôre improving every day. Keep the streak alive!</p>
      <p class="streak">üî• 0-day streak</p>
    </div>

    <!-- Overview Cards -->
    <div class="overview-grid">
      <div class="overview-card">
        <h2>XP</h2>
        <p id="xpScore">+0 XP</p>
      </div>
      <div class="overview-card">
        <h2>Accuracy</h2>
        <p id="accuracyScore">0%</p>
      </div>
      <div class="overview-card">
        <h2>Fluency</h2>
        <p id="fluencyScore">0%</p>
      </div>
      <div class="overview-card">
        <h2>Time Spent</h2>
        <p id="timeSpent">0 mins</p>
      </div>
    </div>

    <!-- Chart -->
    <div class="chart-section">
      <h2>Your Skill Performance</h2>
      <canvas id="resultsChart"></canvas>
    </div>

    <!-- Detailed Breakdown -->
    <div class="details-section">
      <h2>Skill Breakdown</h2>
      <div id="skillsGrid" class="skills-breakdown"></div>
    </div>

    <!-- Button -->
    <button class="next-btn" onclick="window.location.href='assessment.html'">
      Continue Practice ‚û°Ô∏è
    </button>
  </div>

  <!-- Updated script -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Pull persisted data
      const scores = JSON.parse(localStorage.getItem("scores")) || {
        read: 0, word: 0, tongue: 0, question: 0, photo: 0, numbers: 0
      };
      const overview = JSON.parse(localStorage.getItem("overview") || "{}");

      // Overview calculations
      const xp = Math.max(50, (overview.samples || 0) * 50); // simple XP model
      const accuracyAvg = overview.accuracy ?? Math.round(
        (Object.values(scores).reduce((a,b)=>a+b,0) / Math.max(1,Object.values(scores).length))
      );
      const fluencyAvg = overview.fluency ?? Math.round(accuracyAvg * 0.9);

      const mins = Math.max(1, Math.round((overview.timeSpentSeconds || 0) / 60));
      const streak = overview.streak || 0;

      // Update UI
      document.getElementById("xpScore").textContent = `+${xp} XP`;
      document.getElementById("accuracyScore").textContent = `${accuracyAvg}%`;
      document.getElementById("fluencyScore").textContent = `${fluencyAvg}%`;
      document.getElementById("timeSpent").textContent = `${mins} mins`;

      const header = document.querySelector(".header-card .streak");
      if (header) header.textContent = `üî• ${streak}-day streak`;

      // Populate breakdown cards
      const grid = document.getElementById("skillsGrid");
      grid.innerHTML = "";
      Object.keys(scores).forEach(skill => {
        let div = document.createElement("div");
        div.className = "skill-badge";
        div.innerHTML = `<h3>${skill.charAt(0).toUpperCase() + skill.slice(1)}</h3><p>${scores[skill]}%</p>`;
        grid.appendChild(div);
      });

      // Bar chart with real scores
      const ctx = document.getElementById("resultsChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: Object.keys(scores),
          datasets: [{
            label: "Score (%)",
            data: Object.values(scores),
            backgroundColor: ["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4"]
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 100 } }
        }
      });

      // Optional: Show a subtle flag if stuttering likelihood was high
      const maxLik = overview.maxStutterLikelihood || 0;
      if (maxLik >= 0.5) {
        const warn = document.createElement("p");
        warn.style.marginTop = "8px";
        warn.style.color = "#ef4444";
        warn.textContent = "‚ö†Ô∏è We noticed signs of disfluency. Consider slower pacing or breathing exercises.";
        document.querySelector(".chart-section").appendChild(warn);
      }
    });
  </script>
</body>
</html>